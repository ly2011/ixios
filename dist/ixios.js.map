{"version":3,"file":"ixios.js","sources":["../src/main.js"],"sourcesContent":["import axios from 'axios'\r\nimport qs from 'qs'\r\n\r\nconst Axios = axios.create({\r\n  baseURL: '/',\r\n  timeout: 0, // 永不超时\r\n  withCredentials: true,\r\n  headers: {\r\n    'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8'\r\n  }\r\n})\r\n\r\nconst { CancelToken } = axios\r\nconst requestMap = new Map()\r\n\r\n// 请求前置拦截器\r\nAxios.interceptors.request.use(\r\n  config => {\r\n    // 兼容没有设置参数，导致解析报错\r\n    config.params = config.params || {}\r\n    config.data = config.data || {}\r\n\r\n    // 防止重复提交(即当前正在进行的相同请求)\r\n    const keyString = qs.stringify(\r\n      Object.assign({}, { url: config.url, method: config.method }, config.data, config.params)\r\n    )\r\n\r\n    if (requestMap.get(keyString)) {\r\n      // 请求缓存中还存在该请求，则取消当前请求\r\n      // 取消当前请求\r\n      config.cancelToken = new CancelToken(cancel => {\r\n        cancel('Please slow down a little')\r\n      })\r\n    }\r\n\r\n    requestMap.set(keyString, true)\r\n    Object.assign(config, { _keyString: keyString })\r\n\r\n    if (config.method === 'post' || config.method === 'put' || config.method === 'delete') {\r\n      // 序列化数据\r\n      config.data = qs.stringify(config.data)\r\n    }\r\n\r\n    return config\r\n  },\r\n  error => {\r\n    return Promise.reject(error)\r\n  }\r\n)\r\n\r\n// 返回响应拦截器\r\nAxios.interceptors.response.use(\r\n  res => {\r\n    // 重置requestMap\r\n    const { config } = res\r\n    // 把已经完成的请求从 requestMap 中移除\r\n    requestMap.set(config._keyString, false)\r\n\r\n    // if (res.status === 200) {\r\n    //   return res.data\r\n    // }\r\n\r\n    return res\r\n  },\r\n  error => {\r\n    return Promise.reject(error)\r\n  }\r\n)\r\n\r\nconst request = (url, data = {}, method = 'post') => {\r\n  return Axios({\r\n    method,\r\n    url,\r\n    data,\r\n    params: method.toUpperCase() === 'GET' && data\r\n  })\r\n}\r\n\r\nexport default request\r\n"],"names":["Axios","axios","create","baseURL","timeout","withCredentials","headers","CancelToken","requestMap","Map","interceptors","request","use","config","params","data","keyString","qs","stringify","Object","assign","url","method","get","cancelToken","cancel","set","_keyString","error","Promise","reject","response","res","toUpperCase"],"mappings":";;;;;;;;;;;;;;EAGA,IAAMA,KAAK,GAAGC,KAAK,CAACC,MAAN,CAAa;EACzBC,EAAAA,OAAO,EAAE,GADgB;EAEzBC,EAAAA,OAAO,EAAE,CAFgB;EAEb;EACZC,EAAAA,eAAe,EAAE,IAHQ;EAIzBC,EAAAA,OAAO,EAAE;EACP,oBAAgB;EADT;EAJgB,CAAb,CAAd;MASQC,cAAgBN,MAAhBM;EACR,IAAMC,UAAU,GAAG,IAAIC,GAAJ,EAAnB;;EAGAT,KAAK,CAACU,YAAN,CAAmBC,OAAnB,CAA2BC,GAA3B,CACE,UAAAC,MAAM,EAAI;EACR;EACAA,EAAAA,MAAM,CAACC,MAAP,GAAgBD,MAAM,CAACC,MAAP,IAAiB,EAAjC;EACAD,EAAAA,MAAM,CAACE,IAAP,GAAcF,MAAM,CAACE,IAAP,IAAe,EAA7B,CAHQ;;EAMR,MAAMC,SAAS,GAAGC,EAAE,CAACC,SAAH,CAChBC,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkB;EAAEC,IAAAA,GAAG,EAAER,MAAM,CAACQ,GAAd;EAAmBC,IAAAA,MAAM,EAAET,MAAM,CAACS;EAAlC,GAAlB,EAA8DT,MAAM,CAACE,IAArE,EAA2EF,MAAM,CAACC,MAAlF,CADgB,CAAlB;;EAIA,MAAIN,UAAU,CAACe,GAAX,CAAeP,SAAf,CAAJ,EAA+B;EAC7B;EACA;EACAH,IAAAA,MAAM,CAACW,WAAP,GAAqB,IAAIjB,WAAJ,CAAgB,UAAAkB,MAAM,EAAI;EAC7CA,MAAAA,MAAM,CAAC,2BAAD,CAAN;EACD,KAFoB,CAArB;EAGD;;EAEDjB,EAAAA,UAAU,CAACkB,GAAX,CAAeV,SAAf,EAA0B,IAA1B;EACAG,EAAAA,MAAM,CAACC,MAAP,CAAcP,MAAd,EAAsB;EAAEc,IAAAA,UAAU,EAAEX;EAAd,GAAtB;;EAEA,MAAIH,MAAM,CAACS,MAAP,KAAkB,MAAlB,IAA4BT,MAAM,CAACS,MAAP,KAAkB,KAA9C,IAAuDT,MAAM,CAACS,MAAP,KAAkB,QAA7E,EAAuF;EACrF;EACAT,IAAAA,MAAM,CAACE,IAAP,GAAcE,EAAE,CAACC,SAAH,CAAaL,MAAM,CAACE,IAApB,CAAd;EACD;;EAED,SAAOF,MAAP;EACD,CA5BH,EA6BE,UAAAe,KAAK,EAAI;EACP,SAAOC,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;EACD,CA/BH;;EAmCA5B,KAAK,CAACU,YAAN,CAAmBqB,QAAnB,CAA4BnB,GAA5B,CACE,UAAAoB,GAAG,EAAI;EACL;EADK,MAEGnB,MAFH,GAEcmB,GAFd,CAEGnB,MAFH;;EAILL,EAAAA,UAAU,CAACkB,GAAX,CAAeb,MAAM,CAACc,UAAtB,EAAkC,KAAlC,EAJK;EAOL;EACA;;EAEA,SAAOK,GAAP;EACD,CAZH,EAaE,UAAAJ,KAAK,EAAI;EACP,SAAOC,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;EACD,CAfH;;EAkBA,IAAMjB,OAAO,GAAG,SAAVA,OAAU,CAACU,GAAD,EAAqC;EAAA,MAA/BN,IAA+B,uEAAxB,EAAwB;EAAA,MAApBO,MAAoB,uEAAX,MAAW;EACnD,SAAOtB,KAAK,CAAC;EACXsB,IAAAA,MAAM,EAANA,MADW;EAEXD,IAAAA,GAAG,EAAHA,GAFW;EAGXN,IAAAA,IAAI,EAAJA,IAHW;EAIXD,IAAAA,MAAM,EAAEQ,MAAM,CAACW,WAAP,OAAyB,KAAzB,IAAkClB;EAJ/B,GAAD,CAAZ;EAMD,CAPD;;;;;;;;"}